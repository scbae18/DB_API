# 상세 가이드라인

## 프로젝트 개요

이 프로젝트는 엑셀 파일의 쇼핑몰 데이터를 PostgreSQL 데이터베이스로 마이그레이션하고, RESTful API를 통해 데이터를 조회할 수 있도록 하는 시스템입니다.

## 데이터베이스 스키마

### 상품정보 테이블
- **주요 컬럼**: 상품ID (PK), 상품명, 브랜드, 판매가, 재고수량 등
- **인덱스**: 상품ID (Primary Key)

### 회원정보 테이블
- **주요 컬럼**: 회원ID (PK), 이름, 이메일, 전화번호, 주소 등
- **인덱스**: 회원ID (Primary Key)

### 주문정보 테이블
- **주요 컬럼**: 주문ID (PK), 회원ID (FK), 주문일시, 주문상태 등
- **인덱스**: 주문ID (Primary Key), 회원ID (Foreign Key)

### 배송정보 테이블
- **주요 컬럼**: 배송ID (PK), 주문ID (FK), 송장번호 (UNIQUE), 배송상태 등
- **인덱스**: 배송ID (Primary Key), 주문ID (Foreign Key), 송장번호 (Unique)

## API 사용 예시

### 1. 상품 정보 조회

**요청:**
```bash
GET /api/products/PRD-0001
```

**응답:**
```json
{
  "success": true,
  "data": {
    "상품ID": "PRD-0001",
    "카테고리": "의류",
    "상품명": "슬림핏 청바지",
    "브랜드": "리바이스",
    "정가(원)": 173000,
    "판매가(원)": 173000,
    "할인율(%)": 0,
    "재고수량": 12,
    "상품상태": "판매중",
    "등록일": "2024-04-08",
    "최종수정일": "2024-04-25",
    "상품설명": "리바이스 슬림핏 청바지 - 고품질 의류 상품입니다.",
    "대표이미지URL": "https://shop.example.com/img/prd_0001.jpg",
    "평점": 4.5,
    "리뷰수": 692,
    "판매수": 4477
  }
}
```

### 2. 회원 정보 조회

**요청:**
```bash
GET /api/members/USR-0001
```

**응답:**
```json
{
  "success": true,
  "data": {
    "회원ID": "USR-0001",
    "로그인ID": "user001",
    "이름": "이서윤",
    "이메일": "user001@kakao.com",
    "전화번호": "010-5533-1722",
    "생년월일": "1975-06-25",
    "성별": "F",
    "우편번호": "27146",
    "기본주소": "경기도 성남시 분당구",
    "상세주소": "B동 805호",
    "가입일": "2023-11-09",
    "최근로그인": "2024-05-22",
    "회원등급": "GOLD",
    "적립포인트": 28028,
    "총주문수": 47,
    "총주문금액(원)": 3661864,
    "상태": "활성",
    "마케팅동의": "Y"
  }
}
```

### 3. 회원 주문 및 송장번호 조회

**요청:**
```bash
GET /api/orders/member/USR-0001/tracking
```

**응답:**
```json
{
  "success": true,
  "data": [
    {
      "주문ID": "ORD-00001",
      "송장번호": "811518691982",
      "택배사": "한진택배",
      "배송상태": "배송완료",
      "배송추적URL": "https://tracker.example.com/한진택배/811518691982"
    },
    {
      "주문ID": "ORD-00002",
      "송장번호": "787001876766",
      "택배사": "로젠택배",
      "배송상태": "배송완료",
      "배송추적URL": "https://tracker.example.com/로젠택배/787001876766"
    }
  ]
}
```

### 4. 송장번호로 배송정보 조회

**요청:**
```bash
GET /api/shipments/tracking/811518691982
```

**응답:**
```json
{
  "success": true,
  "data": {
    "배송ID": "SHP-00001",
    "주문ID": "ORD-00001",
    "택배사": "한진택배",
    "송장번호": "811518691982",
    "배송상태": "배송완료",
    "발송일": "2025-02-07",
    "예상도착일": "2025-02-10",
    "실제도착일": "2025-02-11",
    "수령인": "권예준",
    "수령인연락처": "010-7806-8484",
    "배송주소": "대전광역시 유성구 101동 1502호",
    "배송메모": "부재시 문앞에 놓아주세요",
    "배송추적URL": "https://tracker.example.com/한진택배/811518691982"
  }
}
```

## 에러 처리

모든 API는 일관된 에러 응답 형식을 사용합니다:

```json
{
  "success": false,
  "message": "에러 메시지",
  "error": "상세 에러 정보 (개발 모드에서만)"
}
```

### 주요 HTTP 상태 코드

- `200`: 성공
- `404`: 리소스를 찾을 수 없음
- `500`: 서버 오류

## Neon 데이터베이스 설정

### 1. Neon 계정 생성 및 프로젝트 생성

1. [Neon Console](https://console.neon.tech) 접속
2. 계정 생성 또는 로그인
3. "Create Project" 클릭
4. 프로젝트 이름 입력 및 데이터베이스 생성

### 2. 연결 문자열 가져오기

1. 프로젝트 대시보드에서 "Connection Details" 클릭
2. 연결 문자열 복사 (형식: `postgresql://user:password@host/database?sslmode=require`)
3. `.env` 파일에 `DATABASE_URL`로 설정

### 3. 데이터베이스 초기화

```bash
# 1. 테이블 생성
node scripts/create-tables.js

# 2. 데이터 마이그레이션
npm run migrate
```

## AWS 배포 체크리스트

### 사전 준비
- [ ] Neon 데이터베이스 생성 및 연결 문자열 확인
- [ ] EC2 인스턴스 생성
- [ ] 보안 그룹 설정 (HTTP, HTTPS, SSH)
- [ ] 도메인 설정 (선택사항)

### 서버 설정
- [ ] Node.js 설치 (18.x 이상)
- [ ] 프로젝트 파일 업로드
- [ ] `.env` 파일 설정
- [ ] 의존성 설치 (`npm install --production`)
- [ ] 데이터베이스 마이그레이션 실행

### 프로세스 관리
- [ ] PM2 설치 및 설정
- [ ] 자동 재시작 설정 (`pm2 startup`, `pm2 save`)

### 웹 서버 (선택사항)
- [ ] Nginx 설치 및 설정
- [ ] 리버스 프록시 설정
- [ ] SSL 인증서 설정 (Let's Encrypt)

### 모니터링
- [ ] PM2 로그 확인 (`pm2 logs`)
- [ ] 서버 상태 확인 (`pm2 status`)
- [ ] API 엔드포인트 테스트

## 보안 고려사항

1. **환경 변수**: `.env` 파일을 절대 Git에 커밋하지 마세요
2. **데이터베이스**: Neon의 SSL 연결을 사용하세요
3. **API**: 프로덕션 환경에서는 인증/인가 메커니즘 추가 고려
4. **CORS**: 필요시 CORS 설정을 더 세밀하게 제어하세요

## 성능 최적화

1. **인덱스**: 자주 조회되는 컬럼에 인덱스가 설정되어 있습니다
2. **연결 풀링**: PostgreSQL 연결 풀을 사용하여 성능을 최적화했습니다
3. **쿼리 최적화**: JOIN을 사용하여 필요한 데이터만 조회합니다

## 추가 개발 아이디어

- [ ] 페이징 처리 추가
- [ ] 검색 기능 추가
- [ ] 필터링 기능 추가
- [ ] 인증/인가 시스템 추가
- [ ] 로깅 시스템 추가
- [ ] 캐싱 레이어 추가 (Redis)
- [ ] API 레이트 리미팅

## 문의 및 지원

문제가 발생하거나 질문이 있으시면 이슈를 등록해주세요.
